# アプリケーション仕様書：YT Downloader for VDMX

## 1. 基本概要
* **目的:** YouTubeの動画を最高画質のMP4としてダウンロードし、VJソフト（VDMXなど）へ即座にドラッグ＆ドロップで投入するためのローカルツール。
* **動作環境:** macOS (Intel / Apple Silicon)
* **開発言語:** Java (JDK 17以降)
* **フレームワーク:** JavaFX (Maven管理)
* **依存ツール:** `yt-dlp`, `ffmpeg` (Homebrew等でインストール済みであること)

## 2. 機能要件

### A. ダウンロード機能
* **入力:** アプリ上部のテキストフィールドにYouTubeのURLを入力。
* **処理:** ボタン押下により、バックグラウンドで `yt-dlp` コマンドを実行。
* **画質設定:**
    * 動画と音声をそれぞれ最高品質でダウンロードし、結合する (`bv+ba/b`)。
    * 結合フォーマットは **MP4** に統一。
* **プレイリスト対応:** URLがプレイリストを含んでいても、**動画単体のみ** をダウンロードする (`--no-playlist`)。
* **保存先:** ユーザーのホームディレクトリ下の `Movies/ytdl` フォルダ。
    * ファイル名規則: `動画タイトル.mp4`

### B. ファイル管理・表示機能
* **リスト表示:** 保存先フォルダ (`~/Movies/ytdl`) 内の `.mp4` ファイルを一覧表示。
* **自動更新:** ダウンロード完了時にリストを最新化。
* **並び順:** 新しいファイルが上に来るようにソート（※コード内の実装依存、現状は逆順）。

### C. 外部連携機能 (Drag & Drop)
* **連携方式:** OSネイティブのドラッグ＆ドロップ。
* **動作:** アプリ内のファイルリストからアイテムをドラッグし、VDMX、Finder、デスクトップ等にドロップすると、ファイルそのものがコピー/移動されたとして扱われる。

## 3. 内部ロジック仕様 (Backend)

### 実行コマンド
Javaの `ProcessBuilder` を介して、以下の構成でシェルコマンドを実行しています。

| 項目         | 設定値                               | 備考                |
|:-----------|:----------------------------------|:------------------|
| **実行バイナリ** | `/usr/local/bin/yt-dlp`           | Intel Macの場合の絶対パス |
| **オプション1** | `--no-playlist`                   | プレイリスト除外          |
| **オプション2** | `-f "bv+ba/b"`                    | 最高画質+最高音質         |
| **オプション3** | `--merge-output-format mp4`       | ffmpegによる結合       |
| **出力パス**   | `~/Movies/ytdl/%(title)s.%(ext)s` |                   |
| **環境変数**   | `PATH` に `/usr/local/bin` を追加     | ffmpeg認識用         |

### 非同期処理
* UIフリーズ防止のため、コマンド実行は別スレッド (Worker Thread) で行う。
* 完了時、JavaFX Application Thread に処理を戻してUI（ボタン、リスト）を更新する。

## 4. UI/UX デザイン
* **ウィンドウサイズ:** 300px × 600px (縦長のバー形状)。
* **表示設定:** `Always On Top` (常に最前面)。他のソフトを操作中も隠れない仕様。
* **構成:**
    1.  URL入力フィールド
    2.  Downloadボタン (実行中は "Downloading..." 表記かつ無効化)
    3.  ダウンロード済みファイルリスト (ListView)

